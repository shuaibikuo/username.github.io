function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}
/*!
 * fps.js v1.0.0
 * (c) 2022-2024 dewu-frontend
 * Released under the MIT License.
 */var DUOTEL_Fps=function(){"use strict";var e=window,t=new(function(){function t(r){_classCallCheck(this,t),this.isBackDoor=!1,this.createPerformanceTestDIVCount=200,this.runTimes=0,this.changeStep=2,this.timeDiffMs=200,this.currentScoreKey="",this.currentScoreTotalKey="",this.lastRunDateKey="fps_last_run_date",this.storeKey="",this.chunkList=[],this.currentScore=450,this.recordCount=0,this.currentTotalScore=0,this.lastRunDate=0,this.runDuration=0,this.maxRunCount=5,this.timer=null,this.requestAnimationFrameId=null,this.requestIdleCallbackId=null,this.onAfterEndFPS=null,this.beginTime=0;var n=r.storeKey,i=r.currentScoreKey,o=r.lastRunDateKey,s=r.runDuration,a=r.isBackDoor,c=r.onAfterEndFPS;if(!n||!i)throw new Error("必须提供storeKey和currentScoreKey");this.isBackDoor=void 0!==a&&a,this.onAfterEndFPS=c,this.chunkList=this.getChunkList(),this.storeKey=n,this.currentScoreKey=i,this.currentScoreTotalKey="".concat(i,"_total"),this.lastRunDateKey=o||"fps_last_run_date",this.currentScore=Number(localStorage.getItem(this.currentScoreKey))||450,this.recordCount=Number(localStorage.getItem(this.storeKey))||0,this.currentTotalScore=Number(localStorage.getItem(this.currentScoreTotalKey))||0,this.lastRunDate=Number(localStorage.getItem(this.lastRunDateKey))||0,this.runDuration=s||0,e._hzScore=this.currentScore,this.visibleCallback=this.visibleCallback.bind(this),this.run=this.run.bind(this),this.listenVisible()}return _createClass(t,[{key:"listenVisible",value:function(){document.addEventListener("visibilitychange",this.visibleCallback)}},{key:"removeListenVisible",value:function(){document.removeEventListener("visibilitychange",this.visibleCallback)}},{key:"visibleCallback",value:function(){"hidden"===document.visibilityState&&(this.removeListenVisible(),"clearTimeout"in window&&clearTimeout(this.timer),"cancelAnimationFrame"in window&&window.cancelAnimationFrame(this.requestAnimationFrameId),"cancelIdleCallback"in window&&window.cancelIdleCallback(this.requestIdleCallbackId))}},{key:"requestCallback",value:function(e){window.requestIdleCallback?this.requestIdleCallbackId=window.requestIdleCallback(e):this.timer=setTimeout(e,6e3)}},{key:"run",value:function(){var e=this,t=this.runDuration&&Date.now()-this.lastRunDate>this.runDuration;this.recordCount<this.maxRunCount||this.isBackDoor||t?(t&&(this.recordCount=0,this.currentTotalScore=0),this.createPerformanceTestDIV(),this.requestCallback((function(){e.beginTime=(new Date).getTime(),e.fpsTick()}))):this.onAfterEndFPS&&this.onAfterEndFPS(localStorage.getItem(this.currentScoreKey))}},{key:"getChunkList",value:function(){var e=this.createPerformanceTestDIVCount,t=Math.ceil(e/3);return[t,2*t,e]}},{key:"createPerformanceTestDIV",value:function(){var e=document.createElement("div");e.id="performanceScoreId";for(var t=0;t<this.createPerformanceTestDIVCount;t++){var r=document.createElement("div");r.style.cssText="\n              position: absolute;\n              top: 100px;\n              width: 10px;\n              height: 10px;\n              background: transparent;\n          ",r.className="performanceScoreClass",e.appendChild(r)}document.body.appendChild(e)}},{key:"removeTestDIV",value:function(){var e=document.querySelector("#performanceScoreId");e&&e.remove()}},{key:"endOfFpsOperation",value:function(e){this.onAfterEndFPS&&this.onAfterEndFPS(e);try{var t=this.recordCount+1,r=this.currentTotalScore+e;if(localStorage.setItem(this.lastRunDateKey,JSON.stringify(Date.now())),localStorage.setItem(this.storeKey,JSON.stringify(t)),localStorage.setItem(this.currentScoreTotalKey,JSON.stringify(r)),this.recordCount){var n=Math.ceil(r/t);localStorage.setItem(this.currentScoreKey,JSON.stringify(n))}else localStorage.setItem(this.currentScoreKey,JSON.stringify(e))}catch(e){}finally{this.removeListenVisible()}}},{key:"fpsTick",value:function(){var e=this;this.requestAnimationFrameId=requestAnimationFrame((function(){var t=document.querySelectorAll(".performanceScoreClass"),r=e.runTimes%e.changeStep;Array.prototype.forEach.call(t,(function(t,n){var i="\n                  position: absolute;\n                  top: 100px;\n                  width: 2px;\n                  height: 2px;\n                  background: transparent;\n              ";n<=e.chunkList[0]?t.setAttribute("style",i+"left: ".concat(["10px","5px"][r],";")):n<=e.chunkList[1]?t.setAttribute("style",i+"transform: translate(".concat(["5px","0"][r],");")):t.setAttribute("style",i+"transform: scale(".concat(["0.5","1"][r],");"))})),e.runTimes++;var n=(new Date).getTime();if(n-e.beginTime<e.timeDiffMs)e.fpsTick();else{var i=n-e.beginTime,o=Math.ceil(1e4/(i/e.runTimes));e.removeTestDIV(),e.endOfFpsOperation(o)}}))}},{key:"testByYouselfInHutaojie",value:function(e){var t=document.createElement("div");t.style.cssText="\n              position: absolute;\n              top: 0;\n              left: 0;\n              z-index: 1000;\n              width: 40px;\n              height: 20px;\n              border: 1px solid red;\n              text-align: center;\n              color: #fff;\n              background: rgba(0,0,0,.5);\n          ",t.innerHTML=String(e||localStorage.getItem(this.currentScoreKey)),document.body.appendChild(t)}}]),t}())({storeKey:"fps_recordCount",currentScoreKey:"device_fps",runDuration:432e6});return e&&(e.FPSPerformanceTest=t),t}();
