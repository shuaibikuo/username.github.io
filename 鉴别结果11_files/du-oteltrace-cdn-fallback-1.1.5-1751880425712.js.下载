function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}
/*!
 * cdn-fallback.js v1.1.5
 * (c) 2022-2025 dewu-frontend
 * Released under the MIT License.
 */!function(){"use strict";var e=window,t=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.retryLimit=0,this.appId="",this.env="",this.debug=!1,this.webpDowngrade=!1,this.backupCdnConfigMap={"cdn.dewu.com":{"cdn.poizon.com":80,"h5static.dewucdn.com":20},"cdn.poizon.com":{"cdn.dewu.com":80,"h5static.dewucdn.com":20},"h5static.dewucdn.com":{"cdn.poizon.com":80,"cdn.dewu.com":20},"image-h5-cdn.dewu.com":{"imagecdn-fall.dewu.com":80,"image-cdn.dewu.com":20},"h5static.dewu.com":{"h5statichw.dewu.com":100},"webimg.dewucdn.com":{"cdn.poizon.com":80,"h5static.dewucdn.com":20}},this.fallbackImage="",this.mergeOptions(t)}return _createClass(e,[{key:"mergeOptions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(t).forEach((function(n){"backupCdnConfigMap"===n?e.backupCdnConfigMap=Object.assign(Object.assign({},e.backupCdnConfigMap),t[n]):e[n]=t[n]}))}},{key:"isInit",value:function(){return Boolean(this.appId)&&Boolean(this.env)}}]),e}(),n=new t,r="CDN Fallback Logger",i="DU_CDN_FALLBACK_DEBUG",a=function(){function t(){var n=this;if(_classCallCheck(this,t),this.enabled=localStorage.getItem(i)||!1,this._console={},e.console=console||e.console,console||e.console){["log","debug","info","warn","error","assert"].forEach((function(t){t in e.console&&(n._console[t]=e.console[t])}))}}return _createClass(t,[{key:"disable",value:function(){this.enabled=!1}},{key:"bindOptions",value:function(e){this.enabled=localStorage.getItem(i)||e}},{key:"enable",value:function(){this.enabled=!0}},{key:"getEnableStatus",value:function(){return this.enabled}},{key:"log",value:function(){var e;if(this.enabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this._console).log.apply(e,["".concat(r,"[Log]:")].concat(n))}}},{key:"warn",value:function(){var e;if(this.enabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this._console).warn.apply(e,["".concat(r,"[Warn]:")].concat(n))}}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this._console).error.apply(e,["".concat(r,"[Error]:")].concat(n))}}]),t}(),o=new a;var c,s={isFunction:(c="Function",function(e){return Object.prototype.toString.call(e)==="[object ".concat(c,"]")}),isInstanceOf:function(e,t){try{return e instanceof t}catch(e){return!1}},isExistProperty:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},l=function(e){return!!e&&/\.(css)($|\?)/i.test(e)},u=function(e){return!!e&&/\.(js)($|\?)/i.test(e)};function f(e){if(e instanceof HTMLImageElement){var t=e.currentSrc||e.src;return t?{type:"image",url:t}:null}if(e instanceof HTMLLinkElement){var n=e.href;return n?{type:"css",url:n}:null}if(e instanceof HTMLScriptElement){var r=e.src;return r?{type:"js",url:r}:null}return null}var d=function(){},m=function(e,t,n){return s.isFunction(e)?e.apply(t,n):null},p=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return"".concat(e()+e(),"-").concat(e())};var h=function(e,t){var n=function(e){var t=e.match(/resize(?:,(?:w_(\d+)|h_(\d+)))+/);if(t){var n=t[0],r=n.match(/w_(\d+)/),i=n.match(/h_(\d+)/);return{width:r?parseInt(r[1]):null,height:i?parseInt(i[1]):null,cdnName:"ali"}}var a=e.match(/thumbnail\/(\d*)x(\d*)/);return a?{width:a[1]?parseInt(a[1]):null,height:a[2]?parseInt(a[2]):null,cdnName:"qiniu"}:null}(e);if(!n)return null;var r=n.width,i=n.height,a=n.cdnName;return"ali"===a?function(e,t,n,r){var i="",a="";if(t&&n)i="resize,w_".concat(t,",h_").concat(n),a="resize,w_".concat(Math.round(t*r),",h_").concat(Math.round(n*r));else if(t&&!n)i="resize,w_".concat(t),a="resize,w_".concat(Math.round(t*r));else{if(t||!n)return e;i="resize,h_".concat(n),a="resize,h_".concat(Math.round(n*r))}return e.replace(i,a)}(e,r,i,t):"qiniu"===a?function(e,t,n,r){var i="",a="";if(t&&n)i="thumbnail/".concat(t,"x").concat(n),a="thumbnail/".concat(Math.round(t*r),"x").concat(Math.round(n*r));else if(t&&!n)i="thumbnail/".concat(t,"x"),a="thumbnail/".concat(Math.round(t*r),"x");else{if(t||!n)return e;i="thumbnail/x".concat(n),a="thumbnail/x".concat(Math.round(n*r))}return e.replace(i,a)}(e,r,i,t):null};function g(e,t,n){var r=!!e[t]&&e.propertyIsEnumerable(t);try{Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}catch(r){try{e[t]=n}catch(e){o.log("无法定义属性 ".concat(String(t),": ").concat(r,", 直接赋值也失败: ").concat(e))}}}function y(e,t,n){if(e&&e[t])if(n)if(s.isFunction(e[t])&&s.isFunction(n)){var r=e[t],i=n(r,t);g(i,"__CDN_Fallback_Original",r),g(i,"__CDN_Fallback_Unwrap",(function(){e[t]===i&&g(e,t,r)})),g(i,"__CDN_Fallback_wrapped",!0),g(e,t,i)}else o.log("原函数 与 包装函数 必须为函数类型");else o.log("没有包装函数");else o.log("".concat(e," 不存在 ").concat(String(t)," 函数 ").concat(String(t)," 无法包装"))}function v(e,t){var n=e[t];e&&n?n.__CDN_Fallback_Unwrap?n.__CDN_Fallback_Unwrap():o.log("".concat(e," 不存在 ").concat(String(t)," 包装函数")):o.log("".concat(e," 不存在 ").concat(String(t)," 函数"))}function b(e){return"function"==typeof e&&"function"==typeof e.__CDN_Fallback_Original&&"function"==typeof e.__CDN_Fallback_Unwrap&&e.__CDN_Fallback_wrapped}var _=Object.keys(HTMLScriptElement.prototype),C=Object.keys(HTMLLinkElement.prototype),w="createElement",k="_cdnFallbackCalled",D="_cdnFallbackOriginalElement",A="_cdnFallbackOriginalErrorEventListener",E="_cdnFallbackCapturedIdentifier",R="_cdnFallbackRetryIdentifier",F="_cdnFallbackOriginalDomainRetryIdentifier",M="_cdnFallbackResizeRetryIdentifier",S=[],I={jsRetryWhiteList:["sociality-h5-ssr"]},L="otelsdk_metric_cdn_fallback",O=function(t){var n,r=e.location.href,i=Object.assign({href:r,version:"1.1.5"},t);if(!(null==e?void 0:e.DUOTEL))return e.DUOTEL_METRIC_CACHE||(e.DUOTEL_METRIC_CACHE={}),e.DUOTEL_METRIC_CACHE[L]||(e.DUOTEL_METRIC_CACHE[L]=[]),void e.DUOTEL_METRIC_CACHE[L].push(i);try{null===(n=null==e?void 0:e.DUOTEL)||void 0===n||n.send(L,i)}catch(e){console.error(e)}},U=function(t,n,r,i,a,c){var s=a||t.defer||t.async;if("loading"===e.document.readyState&&!/Edge|MSIE|rv:/i.test(navigator.userAgent)&&!s){var l=p(),u=t.outerHTML.replace(/_cdnFallbackRetryIdentifier="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/," ".concat("_cdnFallbackRetryInitSync","=true ").concat(R,"=").concat(l,' src="').concat(n,'"$1'));return setTimeout((function(){var t=e.document.querySelector("script[".concat(R,'="').concat(l,'"]'));t&&(t.onload=function(){var e={message:c?"相同URL重试成功":"备用域名重试成功",originalDomain:r,currentDomain:i,resourceUrl:n,type:"js"};o.log(e.message,e),O(e)})}),0),void e.document.write(u)}var f=e.document.createElement("script");_.forEach((function(e){if("src"!==e&&t[e]&&"object"!==_typeof(t[e]))try{f[e]=t[e]}catch(e){}})),f.src=n,f.onload=function(){var e={message:c?"相同URL重试成功":"备用域名重试成功",originalDomain:r,currentDomain:i,resourceUrl:n,type:"js"};o.log(e.message,e),O(e)},f.onerror=t.onerror,f.setAttribute(R,p());var d=t.getAttribute("nonce");d&&f.setAttribute("nonce",d),e.document.getElementsByTagName("head")[0].appendChild(f)},j=function(t,n,r,i,a,c){var s=e.document.createElement("link");C.forEach((function(e){if("href"!==e&&t[e]&&"object"!==_typeof(t[e]))try{s[e]=t[e]}catch(e){}})),s.href=n,s.onload=function(){var e={message:c?"相同URL重试成功":"备用域名重试成功",originalDomain:r,currentDomain:i,resourceUrl:n,type:"css"};o.log(e.message,e),O(e)},s.onerror=t.onerror,s.setAttribute(R,p()),e.document.getElementsByTagName("head")[0].appendChild(s)},T=new(function(){function e(){var t=this;_classCallCheck(this,e),this.originalDomainMap=new Map,this.triedDomainsMap=new Map,this.currentDomainMap=new Map,this.urlRetryCountMap=new Map,this.originalDomainFn={get:function(e){return t.originalDomainMap.get(e)},set:function(e,n){t.originalDomainMap.set(e,n)}},this.triedDomainsFn={get:function(e){return t.triedDomainsMap.has(e)||t.triedDomainsMap.set(e,new Set),t.triedDomainsMap.get(e)},add:function(e,n){t.triedDomainsFn.get(e).add(n)}},this.currentDomainFn={get:function(e){return t.currentDomainMap.get(e)},set:function(e,n){t.currentDomainMap.set(e,n)}}}return _createClass(e,[{key:"handleResourceRetry",value:function(e,t,r,i){var a=n.backupCdnConfigMap,c=function(e){try{var t=new URL(e);return{hostname:t.hostname,pathname:t.pathname}}catch(e){return null}}(t)||{},s=c.hostname,l=c.pathname;if(s){var u=e.hasAttribute(R),f=e.hasAttribute(F),d=e.hasAttribute(M),m=u?"备用域名资源加载失败":"资源加载失败";f&&!d&&(m="兜底原始域名资源加载失败"),f&&d&&(m="兜底同比例缩放资源加载失败");var p={message:m,currentDomain:s,resourceUrl:t,type:r};o.log(null==p?void 0:p.message,p),O(p);var h=this.originalDomainFn.get(l);if(!u)if(h||(h=s,this.originalDomainFn.set(l,s)),!(null==a?void 0:a[h])){var g={message:"无备用域名",originalDomain:h,currentDomain:s,resourceUrl:t,type:r};return o.log(g.message,g),O(g),void("image"===r?f?d?this.handleFailureStrategy(e,r):this.replaceImageSource(e,t,h,h,{isResizeRetry:!0}):this.replaceImageSource(e,t,h,h,{isOriginalDomainRetry:!0}):this.handleFailureStrategy(e,r))}!u||f||d||this.triedDomainsFn.add(l,s),"onload"in e&&(e.onload=null),"onerror"in e&&(e.onerror=null);var y=t.split("?")[0],v=this.urlRetryCountMap.get(y)||0;if(v<((null==n?void 0:n.retryLimit)||0)){var b=this.addTimestampToUrl(y);switch(r){case"image":this.replaceImageSource(e,b,s,s,{isSameUrlRetry:!0});break;case"css":j(e,b,s,s,0,!0);break;case"js":U(e,b,s,s,i,!0)}this.urlRetryCountMap.set(y,v+1);var _={message:"相同URL重试",currentDomain:s,resourceUrl:y,retryCount:v+1,maxRetries:n.retryLimit,type:r};return o.log(_.message,_),void O(_)}var C=this.selectNextDomain(h,l);if(C){this.currentDomainFn.set(l,C);var w=t.replace(s,C);switch(r){case"image":this.replaceImageSource(e,w,h,C);break;case"css":j(e,w,h,C);break;case"js":U(e,w,h,C,i)}var k={message:"域名切换重试",originalDomain:h,currentDomain:C,resourceUrl:w,type:r};o.log(k.message,k),O(k)}else{if(!f&&!d){var D={message:"所有备用域名重试失败",originalDomain:h,currentDomain:s,resourceUrl:t,type:r};o.log(D.message,D),O(D)}"image"===r?this.handleImageFallback(e,t,s,h):this.handleFailureStrategy(e,r)}}}},{key:"selectNextDomain",value:function(e,t){var r,i=null===(r=n.backupCdnConfigMap)||void 0===r?void 0:r[e];if(!i)return null;var a=this.triedDomainsFn.get(t),o=Object.keys(i).filter((function(e){return!a.has(e)}));return 0===o.length?null:(o.sort((function(e,t){return i[t]-i[e]})),o[0])}},{key:"addTimestampToUrl",value:function(e){var t=e.includes("?")?"&":"?";return"".concat(e).concat(t,"_t=").concat(Date.now())}},{key:"handleImageFallback",value:function(e,t,n,r){var i=e.hasAttribute(F),a=e.hasAttribute(M),c=t.replace(n,r);if(i||a)if(!a&&i){var s=h(c,.3);if(s){this.replaceImageSource(e,s,r,r,{isResizeRetry:!0});var l={message:"兜底同比例缩放重试",originalDomain:r,currentDomain:n,resourceUrl:s,type:"image"};o.log(l.message,l),O(l)}else this.handleFailureStrategy(e,"image")}else this.handleFailureStrategy(e,"image");else{this.replaceImageSource(e,c,r,r,{isOriginalDomainRetry:!0});var u={message:"兜底原始域名重试",originalDomain:r,currentDomain:n,resourceUrl:c,type:"image"};o.log(u.message,u),O(u)}}},{key:"replaceImageSource",value:function(e,t,n,r,i){var a=i||{},c=a.isSameUrlRetry,s=void 0!==c&&c,l=a.isOriginalDomainRetry,u=void 0!==l&&l,f=a.isResizeRetry,d=void 0!==f&&f;e.onload=function(){if(e.complete&&e.naturalWidth>0){e.style.opacity="1";var i={message:s?"相同URL重试成功":u?"兜底原始域名重试成功":d?"兜底同比例缩放重试成功":"备用域名重试成功",originalDomain:n,currentDomain:r,resourceUrl:t,type:"image"};o.log(i.message,i),O(i)}},e.setAttribute(R,p()),u&&e.setAttribute(F,p()),d&&e.setAttribute(M,p()),e.src=t}},{key:"handleFailureStrategy",value:function(e,t){if("image"===t)e instanceof HTMLImageElement&&(e.src=(null==n?void 0:n.fallbackImage)||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=")}}]),e}()),P=function(){function t(){_classCallCheck(this,t),this.init()}return _createClass(t,[{key:"init",value:function(){!function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.addEventListener(t,n,r)}(e,"error",(function(e){if(n.isInit()){var t=e.target,r=f(t);if(r){var i,a,o=r.type,c=r.url;switch(o){case"image":if(!function(e){return!!e&&/\.(jpg|jpeg|png|gif|webp|svg|ico)($|\?)/i.test(e)}(c))return;if(S.includes(c))return;if(n.webpDowngrade&&function(e){return!!e&&e.includes("webp")}(c)&&(i=document.querySelector("html"),a=document.querySelector("body"),!(null==i?void 0:i.classList.contains("support-webp"))&&"support"!==(null==i?void 0:i.getAttribute("webp"))&&!(null==a?void 0:a.classList.contains("webp"))&&(null==a?void 0:a.getAttribute("data-unsupport-webp"))))return;T.handleResourceRetry(t,c,"image");break;case"css":if(!l(c)||t.getAttribute(E)||"stylesheet"!==t.getAttribute("rel"))return;T.handleResourceRetry(t,c,"css");break;case"js":if(!I.jsRetryWhiteList.includes(n.appId))return;if(!u(c)||t.getAttribute(E))return;T.handleResourceRetry(t,c,"js")}}}}),!0)}}]),t}(),N=function(){function t(){_classCallCheck(this,t),this.rewriteCreateElement()}return _createClass(t,[{key:"rewritePrototype",value:function(e){Object.keys(e).filter((function(t){try{return s.isFunction(e[t])}catch(e){return!1}})).forEach((function(t){b(e[t])&&v(e,t),y(e,t,(function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.map((function(e){return e&&s.isExistProperty(e,D)?e[D]:e}));return m(e,this,i)}}))}))}},{key:"createProxyElement",value:function(e){e.setAttribute(E,"true");var t=_defineProperty(_defineProperty({},D,e),A,d);return new Proxy(t,{get:function(e,n){return n===D?t[D]:n===A?t[A]:s.isFunction(t[D][n])?function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return m(t[D][n],t[D],r)}:t[D][n]},set:function(e,r,i){return"onerror"===r?(t[A]=i,t[D].onerror=function(e){if("string"!=typeof e){e.stopPropagation&&e.stopPropagation();var r=f(t[D]);if(r){var i=r.type,a=r.url;if("css"===i&&l(a)&&T.handleResourceRetry(t[D],a,"css",!0),"js"===i&&u(a)){if(!I.jsRetryWhiteList.includes(n.appId))return;T.handleResourceRetry(t[D],a,i,!0)}}}},!0):"onload"===r?(t[D].onload=function(e){i&&!i[k]&&(i[k]=!0,m(i,t[D],[e]))},!0):(t[D][r]=i,!0)}})}},{key:"rewriteCreateElement",value:function(){var t=this;b(e.document[w])&&v(e.document,w),y(e.document,w,(function(e){var n=t;return function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var a=r[0],o=m(e,this,r);return"script"===a||"link"===a?n.createProxyElement(o):o}})),"undefined"!=typeof Node&&this.rewritePrototype(Node.prototype),"undefined"!=typeof Element&&this.rewritePrototype(Element.prototype)}}]),t}(),x=function(){function t(r){_classCallCheck(this,t),this.options=n,this.setConfig(Object.assign(r||{},e.__CDN_STATIC_CONFIG__||{})),this.setConfig=this.setConfig.bind(this),this.init()}return _createClass(t,[{key:"init",value:function(){new N,new P}},{key:"setConfig",value:function(e){o.bindOptions(e.debug||!1),this.options.mergeOptions(e)}}]),t}();try{"undefined"!=typeof window&&"undefined"!=typeof document&&(e.DU_CDN_FALLBACK=e.DU_CDN_FALLBACK||new x({}))}catch(e){console.error(e)}}();
